<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../../css/Unit2/conversation.css">
    <link rel="stylesheet" href="../../../bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../../../node_modules/animate.css/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Balsamiq+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <title>Conversation UI</title>
</head>

<style>
    .slide-out {
        animation: slideOut 1s forwards;
    }

    @keyframes slideOut {
        from {
            transform: translateY(0);
            opacity: 1;
        }

        to {
            transform: translateY(100%);
            opacity: 0;
        }
    }
</style>

<body>

    <div class="page-body">
        <div class="container d-flex flex-column justify-content-center align-items-center">

            <h1 class="title text-center">Conversation 1</h1>
            <div class="button-container text-center my-3">
                <a href="./soal.html" class="button" id="button-next">Next</a>
            </div>
            <div class="conversation-container text-center animate__animated" id="conversationContainer">
                <div class="conversation-1">
                    <span id="text">
                        Laura: What's your favorite subject?
                    </span>
                    <img class="audio-icon" src="../../../Asset/icon/Sound.png" alt="Audio" id="audio-1">
                    <audio id="audio1">
                        <source src="../../../Asset/audio/unit1/conversation1/brian.mp3" type="audio/mp3">
                    </audio>
                </div>
                <div class="conversation-2">
                    <span id="text">
                        Galih: I Really Like Science. How About You?
                    </span>
                    <img class="audio-icon" src="../../../Asset/icon/Sound.png" alt="Audio" id="audio-2">
                    <audio id="audio2">
                        <source src="../../../Asset/audio/unit1/conversation1/farza.mp3" type="audio/mp3">
                    </audio>
                </div>
                <div class="conversation-1">
                    <span id="text">
                        Laura: I'm Into English! Love Reading Stories.
                    </span>
                    <img class="audio-icon" src="../../../Asset/icon/Sound.png" alt="Audio" id="audio-3">
                    <audio id="audio3">
                        <source src="../../../Asset/audio/unit1/conversation1/brian1.mp3" type="audio/mp3">
                    </audio>
                </div>
                <div class="conversation-2">
                    <span id="text">
                        Galih: Nice! I don't Like History much, though.
                    </span>
                    <img class="audio-icon" src="../../../Asset/icon/Sound.png" alt="Audio" id="audio-4">
                    <audio id="audio4">
                        <source src="../../../Asset/audio/unit1/conversation1/farza1.mp3" type="audio/mp3">
                    </audio>
                </div>
            </div>
            <div class="conversation-container icon-container">
                <img class="icon-topi" src="../../../Asset/icon/Topi.png" alt="Topi Icon">
                <img class="icon-jangka" src="../../../Asset/icon/Jangka.png" alt="Jangka Icon">
                <img class="icon-book" src="../../../Asset/icon/Buku 1.png" alt="Buku Icon">
            </div>

        </div>

        <div class="characters">
            <div class="character_girl">
                <img src="../../../Asset/icon/Perempuan.png" alt="Character Girl">
            </div>
            <div class="board-container">
                <img class="board" src="../../../Asset/icon/papan_tulis.png" alt="Character Girl">
                <div class="subjects-container">
                    <button class="subjects-button d-none" id="default-button">
                        <img class="subjects" src="../../../Asset/icon/mapel.png" alt="">
                        <div class="subjects theSubjects">
                            <img class="subject" src="../../../Asset/icon/home.png" alt="">
                            <div class="subject-name-container">
                                <span class="subject-name">First</span>
                            </div>
                        </div>
                    </button>
                    <button class="subjects-button" id="sports-button">
                        <img class="subjects" src="../../../Asset/icon/mapel.png" alt="">
                        <div class="subjects theSubjects">
                            <img class="subject" src="../../../Asset/icon/bola.png" alt="">
                            <div class="subject-name-container">
                                <span class="subject-name">Sports</span>
                            </div>
                        </div>
                    </button>
                    <button class="subjects-button" id="science-button">
                        <img class="subjects" src="../../../Asset/icon/mapel.png" alt="">
                        <div class="subjects theSubjects">
                            <img class="subject" src="../../../Asset/icon/Botol_kimia.png" alt="">
                            <div class="subject-name-container">
                                <span class="subject-name">Science</span>
                            </div>
                        </div>
                    </button>
                    <button class="subjects-button" id="history-button">
                        <img class="subjects" src="../../../Asset/icon/mapel.png" alt="">
                        <div class="subjects theSubjects">
                            <img class="subject" src="../../../Asset/icon/history_book.png" alt="">
                            <div class="subject-name-container">
                                <span class="subject-name">History</span>
                            </div>
                        </div>
                    </button>
                    <button class="subjects-button" id="math-button">
                        <img class="subjects" src="../../../Asset/icon/mapel.png" alt="">
                        <div class="subjects theSubjects">
                            <img class="subject" src="../../../Asset/icon/Jangka.png" alt="">
                            <div class="subject-name-container">
                                <span class="subject-name">Math</span>
                            </div>
                        </div>
                    </button>
                    <div class="subjects-buttons">
                        <div class="practice">
                            <h6 class="subject-name">Choose a conversation theme then practice it with your friends</h6>
                        </div>
                    </div>
                </div>
            </div>
            <div class="character_boy">
                <img src="../../../Asset/icon/Laki_Laki.png" alt="Character Boy">
            </div>
        </div>

    </div>


    <img src="../../../Asset/icon/dekorasi_1.png" alt="Dekorasi_1" class="dekorasi_1 dekorasi-top-right-1 ">
    <img src="../../../Asset/icon/dekorasi_1.png" alt="Dekorasi 1" class="dekorasi_1 dekorasi-bottom-left-1">
    <img src="../../../Asset/icon/dekorasi_2.png" alt="Dekorasi 2" class="dekorasi_2 dekorasi-top-left-2">
    <img src="../../../Asset/icon/dekorasi_2.png" alt="Dekorasi 2" class="dekorasi_2 dekorasi-bottom-right-2">


    <img src="../../../Asset/icon/Setting.png" alt="Setting" class="image-setting" id="settingButton">
    <img src="../../../Asset/icon/Setting On.png" alt="Setting On" class="image-setting-on" id="settingOnButton"
        style="display: none;">

    <a href="./unit2.html">
        <img src="../../../Asset/icon/home.png" alt="Home" class="image-home">
    </a>

    <div class="audio-controls">
        <img src="../../../Asset/icon/Mute.png" alt="Mute" class="image-mute" id="muteButton" style="display: none;">
        <img src="../../../Asset/icon/Sound.png" alt="Sound" class="image-sound" id="soundButton" style="display:none;">
    </div>

    <audio id="audio" preload="auto" loop>
        <source id="audioSource" src="../../../Asset/audio/sound.mp3" type="audio/mp3">
    </audio>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const audio = document.getElementById("audio");
            const audioSource = document.getElementById("audioSource");
            const muteButton = document.getElementById("muteButton");
            const soundButton = document.getElementById("soundButton");
            const settingButton = document.getElementById("settingButton");
            const settingOnButton = document.getElementById("settingOnButton");

            function playAudio(audioId) {
                const audioElement = document.getElementById(audioId);
                if (audioElement) {
                    audioElement.muted = false;
                    audioElement.pause();
                    audioElement.currentTime = 0;
                    audioElement.play().catch(error => console.log("Autoplay diblokir:", error));
                }
            }

            document.getElementById("audio-1").addEventListener("click", function () {
                playAudio("audio1");
                audio.pause()
                setTimeout(() => {
                    audio.play()
                }, 3000);
            });

            document.getElementById("audio-2").addEventListener("click", function () {
                playAudio("audio2");
                audio.pause()
                setTimeout(() => {
                    audio.play()
                }, 3000);
            });

            document.getElementById("audio-3").addEventListener("click", function () {
                playAudio("audio3");
                audio.pause()
                setTimeout(() => {
                    audio.play()
                }, 4000);
            });

            document.getElementById("audio-4").addEventListener("click", function () {
                playAudio("audio4");
                audio.pause()
                setTimeout(() => {
                    audio.play()
                }, 3000);
            });

            const songs = [
                "../../../Asset/audio/sound.mp3",
                "../../../Asset/audio/audio2.mp3",
                "../../../Asset/audio/audio3.mp3"
            ];
            let currentSongIndex = 0;

            audio.loop = true;

            if (sessionStorage.getItem("sessionActive")) {
                const savedTime = localStorage.getItem("audioTime");
                const savedIndex = localStorage.getItem("audioIndex");

                if (savedIndex !== null) {
                    currentSongIndex = parseInt(savedIndex);
                    audioSource.src = songs[currentSongIndex];
                    audio.load();
                }
                if (savedTime !== null) {
                    audio.currentTime = parseFloat(savedTime);
                }
            } else {
                localStorage.removeItem("audioTime");
                localStorage.removeItem("audioIndex");
                currentSongIndex = 0;
                audioSource.src = songs[currentSongIndex];
                audio.load();
            }

            sessionStorage.setItem("sessionActive", "true");

            const isMuted = localStorage.getItem("audioMuted") === "true";
            audio.muted = isMuted;

            function playMainAudio() {
                audio.play().catch(() => {
                    console.log("Autoplay diblokir, menunggu interaksi pengguna.");
                });
            }

            playMainAudio();

            audio.addEventListener("timeupdate", function () {
                if (sessionStorage.getItem("sessionActive")) {
                    localStorage.setItem("audioTime", audio.currentTime);
                    localStorage.setItem("audioIndex", currentSongIndex);
                }
            });

            function updateSoundButtons() {
                muteButton.style.display = audio.muted ? "block" : "none";
                soundButton.style.display = audio.muted ? "none" : "block";
            }

            muteButton.addEventListener("click", () => {
                audio.muted = false;
                localStorage.setItem("audioMuted", "false");
                updateSoundButtons();
            });

            soundButton.addEventListener("click", () => {
                audio.muted = true;
                localStorage.setItem("audioMuted", "true");
                updateSoundButtons();
            });

            settingButton.addEventListener("click", () => {
                settingButton.style.display = "none";
                settingOnButton.style.display = "block";
                updateSoundButtons();
            });

            settingOnButton.addEventListener("click", () => {
                settingOnButton.style.display = "none";
                settingButton.style.display = "block";
                muteButton.style.display = "none";
                soundButton.style.display = "none";
            });

            muteButton.style.display = "none";
            soundButton.style.display = "none";

            document.getElementById("button-next").addEventListener("click", function (event) {
                event.preventDefault();
                const container = document.querySelector(".page-body");
                container.classList.add("slide-out");
                setTimeout(() => {
                    window.location.href = this.getAttribute("href");
                }, 1000);
            });
        });

        // conversation

        const conversations = {
            default: [
                { speaker: "Laura", text: "What's your favorite subject?", audio: "/Asset/audio/unit1/conversation1/brian.mp3" },
                { speaker: "Galih", text: "I really like science. How about you?", audio: "/Asset/audio/unit1/conversation1/farza.mp3" },
                { speaker: "Laura", text: "I'm into English! I love reading stories.", audio: "/Asset/audio/unit1/conversation1/brian1.mp3" },
                { speaker: "Galih", text: "Nice! I like science, but I find history a bit boring.", audio: "/Asset/audio/unit1/conversation1/farza1.mp3" }
            ],
            sports: [
                { speaker: "Laura", text: "Do you play any sports?", audio: "/Asset/audio/unit1/conversation1/brian.mp3" },
                { speaker: "Galih", text: "Yes! I love playing soccer!", audio: "/Asset/audio/unit1/conversation1/farza.mp3" },
                { speaker: "Laura", text: "That's great! Are you part of a team?", audio: "/Asset/audio/unit1/conversation1/brian1.mp3" },
                { speaker: "Galih", text: "Yes, I play for my school team. We have matches every weekend!", audio: "/Asset/audio/unit1/conversation1/farza1.mp3" }
            ],
            history: [
                { speaker: "Laura", text: "Do you like history?", audio: "/Asset/audio/unit1/conversation1/brian.mp3" },
                { speaker: "Galih", text: "It's interesting, but sometimes too detailed.", audio: "/Asset/audio/unit1/conversation1/farza.mp3" },
                { speaker: "Laura", text: "I get that! But do you have a favorite historical event?", audio: "/Asset/audio/unit1/conversation1/brian1.mp3" },
                { speaker: "Galih", text: "Yes! I find the Renaissance period really fascinating.", audio: "/Asset/audio/unit1/conversation1/farza1.mp3" }
            ],
            science: [
                { speaker: "Laura", text: "Do you like science?", audio: "/Asset/audio/unit1/conversation1/brian.mp3" },
                { speaker: "Galih", text: "Yes! Science explains how everything works!", audio: "/Asset/audio/unit1/conversation1/farza.mp3" },
                { speaker: "Laura", text: "That's true! Do you like physics or biology more?", audio: "/Asset/audio/unit1/conversation1/brian1.mp3" },
                { speaker: "Galih", text: "I love physics! Learning about space and gravity is so exciting.", audio: "/Asset/audio/unit1/conversation1/farza1.mp3" }
            ],
            math: [
                { speaker: "Laura", text: "Do you like math?", audio: "/Asset/audio/unit1/conversation1/brian.mp3" },
                { speaker: "Galih", text: "It's challenging, but I enjoy solving problems.", audio: "/Asset/audio/unit1/conversation1/farza.mp3" },
                { speaker: "Laura", text: "Nice! Do you prefer algebra or geometry?", audio: "/Asset/audio/unit1/conversation1/brian1.mp3" },
                { speaker: "Galih", text: "I really like algebra! Equations are like puzzles to me.", audio: "/Asset/audio/unit1/conversation1/farza1.mp3" }
            ]
        };

        function updateConversation(topic) {
            const conversationContainer = document.querySelector(".conversation-container");
            conversationContainer.innerHTML = "";
            conversationContainer.classList.add("animate__pulse");
            setTimeout(() => {
                conversationContainer.classList.remove("animate__pulse");
            }, 1000);


            conversations[topic].forEach((line, index) => {
                const conversationDiv = document.createElement("div");
                conversationDiv.className = `conversation-${index % 2 === 0 ? '1' : '2'}`;

                const textSpan = document.createElement("span");
                textSpan.textContent = `${line.speaker}: ${line.text}`;

                const audioIcon = document.createElement("img");
                audioIcon.src = "/Asset/icon/Sound.png";
                audioIcon.alt = "Audio";
                audioIcon.className = "audio-icon";
                audioIcon.addEventListener("click", () => playAudio(line.audio));

                const audioElement = document.createElement("audio");
                const sourceElement = document.createElement("source");
                sourceElement.src = line.audio;
                sourceElement.type = "audio/mp3";
                audioElement.appendChild(sourceElement);

                conversationDiv.appendChild(textSpan);
                conversationDiv.appendChild(audioIcon);
                conversationDiv.appendChild(audioElement);

                conversationContainer.appendChild(conversationDiv);
            });
        }

        function playAudio(audioSrc) {
            const audio = new Audio(audioSrc);
            audio.play();
        }

        document.getElementById("default-button").addEventListener("click", () => updateConversation("default"));
        document.getElementById("sports-button").addEventListener("click", () => updateConversation("sports"));
        document.getElementById("history-button").addEventListener("click", () => updateConversation("history"));
        document.getElementById("math-button").addEventListener("click", () => updateConversation("math"));
        document.getElementById("science-button").addEventListener("click", () => updateConversation("science"));
    </script>

</body>

</html>